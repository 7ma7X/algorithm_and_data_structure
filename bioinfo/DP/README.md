# ペアワイズアラインメント（Pairwise Sequence Alignment）

2 本の DNA 配列を並べる。DNA 配列は進化の過程で変異・欠失・挿入が起こるが、2 本の比較によりそれらのイベントが分かる。  
最も「見た目のいい」並べ方とは？を数学的に考察

## Sum of Pair スコア体系

- マッチ 3 点
- ミスマッチ -4 点
- ギャップ -5 点

ex)

ACT  
ACG  
👉 3 + 3 + (-4) = 2

A-CT  
AC-G  
👉 3 + (-5) + (-5) + (-4) = -11

ACT-  
A-CG  
👉 3 + (-5) + (-4) + (-5) = -11

-ACT  
A-CG  
👉 (-5) + (-5) + 3 + (-4) = -11

-ACT  
AC-G  
👉 (-5) + (-4) + (-5) + (-4) = -18

- 目的によってスコアの設定を適切に変えよう
- アミノ酸配列を比較する際は、20 種類のアミノ酸同士の組み合わせそれぞれに対して個別にスコアを割り当てることが多い（例: [BLOSUM60](https://github.com/trinityrnaseq/trinityrnaseq/blob/master/Butterfly/src/src/jaligner/matrix/matrices/BLOSUM60)）

# Needleman-Wunsch アルゴリズム（Global alignment）

配列 S_1, S_2 が与えられるとき、**全体で**SP スコアが最高となるアラインメントとそのスコアを求める。

## 最適スコアを求める

S_1 の先頭から i 文字目までからなる部分文字列を S_1[i] とする。S_2 も同様。D[i][j]を S_1[i] と S_2[j] の最適アラインメントにおける SP スコアとする。  
このとき、

初期条件:
D[i][0] = gi, D[0][j] = gj  
再帰方程式:
D[i][j] = max( D[i-1][j] + g, D[i][j-1] + g, D[i-1][j-1] + f(s1_i, s2_j) )

を解く。（ただし, g はギャップペナルティ -5 で, f(s1_i, s2_j) は S_1 の i 文字目と S_2 の j 文字目の類似度（マッチ: +3, ミスマッチ: -4））

## 最適アラインメントを求める

- 方法 1

D の計算を行う際、どのルートから来た場合が max だったかを都度記録（表の中では矢印）していき、計算が終わったら終着点（表の中では右下）から逆にたどる（トレースバック）

- 方法 2(より高速)

矢印を記録せずにトレースバックする。つまり、再度計算して戻っていく（表の中では、上か左の値が +5 になっているか、それとも左上の値が同じだったら -3, 違かったら +4 になっているか、を調べて戻っていく）。

# Smith-Waterman アルゴリズム（Local alignment）

配列 S_1, S_2 が与えられるとき、**局所的に**SP スコアが最高となるアラインメントとそのスコアを求める（S_1, S_2 それぞれの先頭および末尾それぞれについて、任意の 0 以上の塩基列を取り除いてからアラインメントしてもよい）。  
Needleman-Wunsch アルゴリズムの違いとしては、まず、スコアを必ず非負にする。具体的には

初期条件:
D[i][0] = 0, D[0][j] = 0  
再帰方程式:
D[i][j] = max( D[i-1][j] + g, D[i][j-1] + g, D[i-1][j-1] + f(s1_i, s2_j), 0 )

そして、最もスコアの高いセルから開始し、スコアがゼロのセルに達したら終了する。  
表、グラフの上では、Needleman-Wunsch アルゴリズムが左上から右下までの経路で最適スコア経路を考えるのに対して、Smith-Waterman アルゴリズムは任意の二点間で最適スコア経路を考えると言える。

# アフィンギャップスコア

配列の切断によって生まれるギャップはひどい場合Mb(100万塩基)レベルある。すなわち、ギャップの開始に比べてギャップの伸張
はさほど重大ではない。  
これをふまえると、1塩基ギャップあたり一定量のギャップスコアを与えるよりも、ギャップ開始スコア d 、ギャップ伸張スコア e を
区別して、x 塩基ギャップに対し d + e (x - 1) (d < e < 0) のギャップスコアを与えるのがよい。これがアフィンギャップスコア。

## Smith-Waterman-Gotoh アルゴリズム

Smith-Waterman アルゴリズムにおいてアフィンギャップスコアを用いるように拡張したアルゴリズム。  
  
参考: http://metabolomics.jp/wiki/Aritalab:Lecture/Bioinformatics/Alignment

# マルチプルアラインメント

ペアワイズアラインメントは2本の配列の「見た目のいい」並べ方を求めるが、マルチプルアラインメントは3本以上で考える。

# 3次元版 Needleman-Wunsch アルゴリズム

再帰方程式の立て方が複雑になる。  

ex)

S1: A  
S2: -  
S3: -  
  
